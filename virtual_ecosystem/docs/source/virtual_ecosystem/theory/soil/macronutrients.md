---
jupytext:
  formats: md:myst
  main_language: python
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.17.1
kernelspec:
  display_name: Python 3 (ipykernel)
  language: python
  name: python3
language_info:
  codemirror_mode:
    name: ipython
    version: 3
  file_extension: .py
  mimetype: text/x-python
  name: python
  nbconvert_exporter: python
  pygments_lexer: ipython3
  version: 3.11.9
---

# Soil macronutrient cycles

In the Virtual Ecosystem, as well as tracking the flow of carbon through the system, we
also track the flow of nitrogen and phosphorus. The reason for tracking these two is
that they are generally though to be the two macronutrients that most limit ecosystem
productivity. A significant portion of the cycling of these elements occurs associated
with carbon. Beyond this organic macronutrient cycle, each element can also cycle
independently of carbon. The processes involved in these inorganic nutrient cycles tend
to be specific to the element of interest.

## Organic macronutrient cycling

The soil and litter model track the nitrogen and phosphorus stoichiometry of each soil
carbon pool. For the majority of processes, the nutrients are assumed to just follow the
flow of carbon, e.g. when microbes die creating microbial necromass amount of
nutrient added to the necromass pool is calculated as

$$d_n = \frac{d_c}{r_{N,m}},$$

where $d_c$ is the amount of necromass generated in carbon terms and $r_{N,m}$ is the
carbon:nitrogen ratio of the microbial group. There are two processes that do not follow
this pattern: litter decomposition and microbial uptake.

Litter decomposition occurs through two pathways, fragmentation and leaching.
Fragmentation results in large pieces of litter being broken up into smaller and smaller
pieces until they are no longer recognisable as litter. Crucially these fragments are
still organic molecules, so here the nutrient flow still follows the carbon flow.
Leaching occurs when water travelling downwards through the litter layer into the soil
proper carries small molecules with it. As these molecules are very small, they can be
either organic or inorganic, and so the nutrients can escape the organic cycle. For
example, the organic phosphorus gets added to the labile (inorganic) phosphorus pool due
to litter decay with rate

$$I_{l} = (1 - \delta_o) * \lambda_l * I_p,$$

where $I_p$ is the total input of phosphorus from the litter to the soil, $\lambda_p$ is
the fraction of the litter decay that occurs by leaching, and $\delta_o$ is the fraction
of the leached phosphorus that enters the soil in an organic form.

Microbes uptake organic matter (in the form of :term:`LMWC`) so that they can synthesis
new biomass. This organic matter also has nitrogen and phosphorus contents (referred to
as :term:`DON` and :term:`DOP`, respectively). This can result in more macronutrient
being taken up than the microbe needs to sustain it's growth. When this happens the
excess macronutrient gets returned to the soil. The form that this excess nutrient gets
returned in depends on how carbon limited the microbial group is. The closer to carbon
limitation (the point where carbon is the nutrient limiting growth) the microbial group
is the higher the proportion that gets returned in an inorganic form is.

## Inorganic nitrogen cycling

A substantial part of the nitrogen cycle occurs via inorganic forms of nitrogen,
particularly in tropical soils. For this reason the model defines a number of inorganic
nitrogen pools, as well as including a number of processes that specifically affect
these inorganic nitrogen pools.

### Inorganic nitrogen pools

#### Ammonium ($\ce{NH^{+}_{4}}$)

Nitrogen fixation is a hugely significant process in tropical soils. It generally
produces ammonia ($\ce{NH_{3}}$). Ammonium ($\ce{NH_{4}^{+}}$) is produced during
organic matter decomposition. Transformation of ammonia to ammonium (and vice versa) is
a frequent occurrence in soils, but the process would be tricky to parametrise and
validate. So, for the sake of simplicity, we just track ammonium, under the assumption
that ammonia and ammonium exist in constant proportion. As well as the processes already
mentioned ammonium can also be generated by leaching from litter. This pool can be taken
up by both plants and microbes, and can be removed from the soil by water flows.

#### Nitrate ($\ce{NO^{-}_{3}}$)

Nitrification results in production of nitrate ($\ce{NO^{-}_{3}}$) from ammonium. This
nitrate can be lost due to leaching and volatilisation, or can be taken up by plant
roots. Nitrate can also be mineralised from :term:`POM` by microbes and can leach into
the soil from the litter layer. This pool can be taken up by both plants and microbes,
and can be removed from the soil by water flows.

### Inorganic nitrogen cycling processes

There are a number of processes specific to the inorganic nitrogen pools. A couple of
these are very simple. Firstly, ammonia added to the system at a fixed rate to
represented environment deposition. Secondly, ammonia volatilises out of the soil at
rate proportional to its concentration in the soil. The other processes are more complex
and are explained in detail below.

#### Nitrogen fixation

Our model of nitrogen fixation makes two major simplifications. Firstly, as already
mentioned we assume that all nitrogen is fixed in the form of ammonium. Secondly, we do
not explicitly represent nitrogen-fixing bacteria as a separate microbial group, instead
we use empirical relations to capture the rate of nitrogen fixation. We do, however,
calculate nitrogen fixation by plant associated bacteria and the nitrogen fixed by
free-living microbes separately. To calculate the rate of nitrogen fixation by plant
symbiotes we use the following expression

$$N_{s}(T) = \frac{S_{p}}{C_{f}(T)},$$

where $S_{p}$ is the rate of carbon supply from the plants to their symbiotic partners,
and $C_{f}(T)$ is the cost of nitrogen fixation at temperature $T$. This fixation cost
is the amount of carbon needed to fix a unit amount of nitrogen. To calculate this we
use the following empirical expression (adapted from {cite}`brzostek_modeling_2014`)

$$
\begin{align}
C_{f}(T) &= \infty \quad T<0, \\
C_{f}(T) &= C_0 + C_{\infty} * (e^{s * T * (1 - (T / T_e))} - 1) \quad T>=0,
\end{align}
$$

where $C_0$ is the cost at zero Celsius, $C_{\infty}$ is the maximum additional cost at
high temperatures (this is asymptotically approached as temperatures tend towards
infinity), $s$ is the sensitivity of the cost to changes in temperature and $T_e$ is the
(positive) temperature at which the fixation cost is equal to the cost at zero degrees
Celsius.

The rate of nitrogen fixation by free-living microbes is simpler to calculate as we
assume that it is only effected by temperature (because there isn't a symbiotic
partner). We calculate the fixation rate using the following expression (adapted from
{cite}`lin_modelling_2000`)

$$N_{f}(T) = f_r * Q_f^{(T - T_r) / 10.0},$$

where $f_r$ is the rate at which free-living microbes fix nitrogen (per unit volume of
topsoil) at the reference temperature $T_r$ and $Q_f$ is the $Q_10$ coefficient for
nitrogen fixation.

#### Nitrification

Nitrification is the process by which nitrate is formed from ammonium in the soil. To
calculate this rate we adapted an empirical relationship used in
{cite}`fatichi_mechanistic_2019`, which makes the assumption that nitrification rate
obeys linear kinetics with variations due to changes in soil temperature and soil
moisture. The nitrification rate is calculated at follows

$$r_n = k_n * f_{T,n} * f_{w,n} * \ce{NH_{4}^{+}},$$

where $k_n$ is the rate constant for nitrification, $f_{T,n}$ is a factor capturing the
impact of soil temperature on nitrification rate (defined
[here](./environmental_links.md#nitrification-temperature-factor)), $f_{w,n}$ is a
factor capturing the impact of soil moisture on nitrification rate (defined
[here](./environmental_links.md#nitrification-moisture-factor)) and $\ce{NH_{4}^{+}}$ is
the concentration of ammonium in the soil.

#### Denitrification

Denitrification is the process by which nitrate is converted into nitrite. This nitrite
is generally rapidly lost to the soil quickly (in a variety of forms) so we don't track
it directly. To calculate the rate at which denitrification occurs we adapted an
empirical relationship used in {cite}`fatichi_mechanistic_2019`, which makes the
assumption that denitrification rate obeys linear kinetics with variations due to
changes in soil temperature and soil moisture. The denitrification rate is calculated at
follows

$$r_d = k_d * f_{T,d} * f_{w,d} * \ce{NO_{3}^{-}},$$

where $k_d$ is the rate constant for denitrification, $f_{T,d}$ is a factor capturing
the impact of soil temperature on denitrification rate (defined
[here](./environmental_links.md#denitrification-temperature-factor)), $f_{w,d}$ is a
factor capturing the impact of soil moisture on denitrification rate (defined
[here](./environmental_links.md#denitrification-moisture-factor)) and $\ce{NO_{3}^{-}}$
is the concentration of nitrate in the soil.

## Inorganic phosphorus cycling

Similarly, inorganic forms of phosphorus play an important role in the total phosphorus
cycle. The soil model therefore defines a set of key inorganic phosphorus pools, along
with processes that specifically effect those pools.

### Inorganic phosphorus pools

#### Primary mineral P

Phosphorus can enter soils through weathering of primary minerals. Though this
contribution to the overall phosphorus budget is likely to be small in our case, we
include it for the sake of model completeness.

#### Labile P

The inorganic phosphorus that can be taken up by plants and microbes is termed labile
phosphorus. This type of phosphorus is formed either by breakdown of organic matter, by
weathering of primary mineral phosphorus, or the breakdown of secondary mineral
phosphorus. This pool can be taken up by both plants and microbes, and can be removed
from the soil by water flows.

#### Secondary mineral P

Labile phosphorus can form associations with minerals that prevent uptake by plants.
This is termed secondary mineral phosphorus. This phosphorus can be liberated from its
mineral association as labile phosphorus.

### Inorganic phosphorus cycling processes

Inorganic phosphorus is added to the system in a couple of ways. Firstly, labile
phosphorus added to the system at a fixed rate to represented environment deposition.
Secondly, tectonic uplift adds new primary mineral phosphorus into the system, obviously
this is a very slow process so the rate of tectonic uplift is set to zero by default.
However, we keep this process in the model as it will be relevant both for long-duration
model runs and if the model is applied to areas of greater tectonic activity.

The breakdown of primary mineral phosphorus into labile inorganic phosphorus is modelled
as a linear decay by

$$b_P = k_P * P_P,$$

where $k_P$ is rate constant for primary phosphorus breakdown and $P_P$ is the density
of primary mineral phosphorus in the soil. The sorption of labile inorganic phosphorus
to soil minerals (forming secondary mineral phosphorus) and the breakdown of secondary
mineral phosphorus (forming labile inorganic phosphorus) are both also assumed to follow
linear kinetics. As such the net formation rate of secondary mineral phosphorus can be
expressed as

$$f_S = k_L * P_L - k_S * P_S,$$

where $k_L$ is the rate constant for sorption of labile inorganic phosphorus to soil
minerals, $P_L$ is the density of labile inorganic phosphorus in the soil, $k_S$ is rate
constant for secondary mineral phosphorus breakdown and $P_S$ is the density of
secondary mineral phosphorus in the soil.
